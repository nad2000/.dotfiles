:

# Start a new session if it is run outsited TMUX
if test -z "${TMUX}" && which tmux &>/dev/null; then
  ID="`tmux ls | grep -vm1 attached | cut -d: -f1`" # get the id of a deattached session
  if [ -z "${ID}" ] ;then # if not available create a new one
    tmux -2 new-session
  else
    tmux -2 attach-session -t ${ID} # if available attach to it
  fi
fi

# sets up tmux with running server at the top pane; nvim in the middle and a command pane at the bottom..
if [ -n "$1" ] ;  then
  cd "$1"
  tmux send-keys "cd \"$1\"" C-m
fi

if [ -x dev ] ; then
  exec ./dev
elif [ -x ddev ] ; then
  exec ./ddev
else
  tmux send-keys 'source ./venv/bin/activate ; ./manage.py runserver' C-m \
    \; split-window -v -p 86 'source ./venv/bin/activate ; nvim -S .session.vim' \
    \; split-window -v -p 12 \
    \; send-keys 'source ./venv/bin/activate' C-m \
    \; select-pane -U
fi
